<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Currency Converter</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f7fb; margin: 0; padding: 0; }
    .container { max-width: 640px; margin: 40px auto; background: #fff; padding: 24px; border-radius: 12px; box-shadow: 0 4px 18px rgba(0,0,0,0.08); }
    h1 { margin-top: 0; }
    form { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    label { display: block; font-weight: 600; margin-bottom: 6px; }
    input, select, button { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #d1d5db; font-size: 14px; }
    button { background: #2563eb; color: white; border: none; cursor: pointer; }
    button:hover { background: #1d4ed8; }
    .secondary { background: #e5e7eb; color: #111827; border: 1px solid #d1d5db; }
    .secondary:hover { background: #d1d5db; }
    .full-row { grid-column: 1 / -1; }
    .actions { display: flex; gap: 10px; justify-content: flex-end; }
    .result { margin-top: 16px; padding: 12px; background: #eef2ff; border-radius: 8px; min-height: 48px; }
    .error { color: #b91c1c; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Convertisseur de devises</h1>
    <p>Saisissez un montant, choisissez les devises source et cible, puis envoyez pour voir le résultat.</p>
    <form id="convert-form">
      <div>
        <label for="amount">Montant</label>
        <input type="number" step="0.01" id="amount" name="amount" value="100" required>
      </div>
      <div>
        <label for="base">Devise source</label>
        <input type="text" id="base" name="base" value="USD" maxlength="3" required>
      </div>
      <div>
        <label for="target">Devise cible</label>
        <input type="text" id="target" name="target" value="EUR" maxlength="3" required>
      </div>
      <div class="full-row actions">
        <button type="button" class="secondary" id="swap">Swap</button>
        <button type="submit">Convertir</button>
      </div>
    </form>
    <div id="result" class="result"></div>
  </div>

  <script>
    const form = document.getElementById('convert-form');
    const resultBox = document.getElementById('result');
    const baseInput = document.getElementById('base');
    const targetInput = document.getElementById('target');
    const swapButton = document.getElementById('swap');

    swapButton.addEventListener('click', () => {
      const currentBase = baseInput.value;
      baseInput.value = targetInput.value;
      targetInput.value = currentBase;
    });

    form.addEventListener('submit', async (event) => {
      event.preventDefault();
      resultBox.textContent = 'Conversion en cours...';
      resultBox.classList.remove('error');
      const formData = new FormData(form);
      try {
        const response = await fetch('/convert', {
          method: 'POST',
          body: formData
        });
        const data = await response.json();
        if (!response.ok || data.error) {
          throw new Error(data.error || 'La conversion a échoué');
        }
        resultBox.textContent = `${data.amount} ${data.base} = ${data.converted} ${data.target} (taux ${data.rate})`;
      } catch (err) {
        resultBox.textContent = err.message;
        resultBox.classList.add('error');
      }
    });
  </script>
</body>
</html>
