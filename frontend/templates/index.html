<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Currency Converter</title>
  <style>
    :root {
      --accent: #0ea5e9;
      --accent-strong: #0284c7;
      --surface: #0b172a;
      --card: #0f243d;
      --muted: #9fb3c8;
    }
    * { box-sizing: border-box; }
    body { font-family: "Segoe UI", "Helvetica Neue", Arial, sans-serif; background: linear-gradient(135deg, #0ea5e9, #22d3ee); margin: 0; padding: 24px; color: #e2e8f0; }
    .container { max-width: 760px; margin: 24px auto; background: var(--card); padding: 28px; border-radius: 16px; box-shadow: 0 18px 50px rgba(0,0,0,0.25), 0 6px 20px rgba(0,0,0,0.15); border: 1px solid rgba(255,255,255,0.08); }
    h1 { margin: 0 0 8px; letter-spacing: 0.4px; }
    p { margin-top: 0; color: var(--muted); }
    form { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 14px; margin-top: 18px; }
    label { display: block; font-weight: 700; margin-bottom: 6px; letter-spacing: 0.2px; color: #e5eefc; }
    input, select, button { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.08); font-size: 15px; background: rgba(255,255,255,0.06); color: #e2e8f0; }
    input:focus, select:focus { outline: 2px solid var(--accent); box-shadow: 0 0 0 3px rgba(14,165,233,0.25); }
    button { background: linear-gradient(135deg, var(--accent), var(--accent-strong)); color: #f8fafc; border: none; cursor: pointer; font-weight: 700; letter-spacing: 0.3px; transition: transform 0.1s ease, box-shadow 0.2s ease; }
    button:hover { transform: translateY(-1px); box-shadow: 0 12px 30px rgba(14,165,233,0.35); }
    .secondary { background: rgba(255,255,255,0.08); color: #e2e8f0; border: 1px solid rgba(255,255,255,0.12); }
    .secondary:hover { box-shadow: 0 10px 24px rgba(0,0,0,0.18); }
    .full-row { grid-column: 1 / -1; }
    .actions { display: flex; gap: 12px; justify-content: flex-end; }
    .result { margin-top: 18px; padding: 14px; background: rgba(255,255,255,0.06); border-radius: 10px; min-height: 52px; border: 1px solid rgba(255,255,255,0.08); }
    .result strong { color: #facc15; }
    .error { color: #fecdd3; }
    .note { color: #fde68a; display: block; margin-top: 6px; font-size: 13px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Convertisseur de devises</h1>
    <p>Saisissez un montant, choisissez les devises source et cible, puis envoyez pour voir le résultat.</p>
    <form id="convert-form">
      <div>
        <label for="amount">Montant</label>
        <input type="number" step="0.01" id="amount" name="amount" value="100" required>
      </div>
      <div>
        <label for="base">Devise source</label>
        <select id="base" name="base"></select>
      </div>
      <div>
        <label for="target">Devise cible</label>
        <select id="target" name="target"></select>
      </div>
      <div class="full-row actions">
        <button type="button" class="secondary" id="swap">Swap</button>
        <button type="submit">Convertir</button>
      </div>
    </form>
    <div id="result" class="result"></div>
  </div>

  <script>
    const form = document.getElementById('convert-form');
    const resultBox = document.getElementById('result');
    const baseInput = document.getElementById('base');
    const targetInput = document.getElementById('target');
    const swapButton = document.getElementById('swap');
    const currencies = [
      ['USD', 'Dollar (USD)'],
      ['EUR', 'Euro (EUR)'],
      ['GBP', 'Livre sterling (GBP)'],
      ['JPY', 'Yen (JPY)'],
      ['CAD', 'Dollar canadien (CAD)'],
      ['AUD', 'Dollar australien (AUD)'],
      ['CHF', 'Franc suisse (CHF)'],
      ['MAD', 'Dirham marocain (MAD)'],
      ['TND', 'Dinar tunisien (TND)'],
      ['CNY', 'Yuan (CNY)'],
    ];

    const populateSelect = (select, defaultValue) => {
      currencies.forEach(([code, label]) => {
        const option = document.createElement('option');
        option.value = code;
        option.textContent = label;
        if (code === defaultValue) {
          option.selected = true;
        }
        select.appendChild(option);
      });
    };

    populateSelect(baseInput, 'USD');
    populateSelect(targetInput, 'EUR');

    swapButton.addEventListener('click', () => {
      const currentBase = baseInput.value;
      baseInput.value = targetInput.value;
      targetInput.value = currentBase;
    });

    form.addEventListener('submit', async (event) => {
      event.preventDefault();
      resultBox.textContent = 'Conversion en cours...';
      resultBox.classList.remove('error');
      const formData = new FormData(form);
      try {
        const response = await fetch('/convert', {
          method: 'POST',
          body: formData
        });
        const data = await response.json();
        if (!response.ok || data.error) {
          throw new Error(data.error || 'La conversion a échoué');
        }
        const detail = `${data.amount} ${data.base} = ${data.converted} ${data.target} (taux ${data.rate})`;
        const note = data.note ? `<span class="note">${data.note}</span>` : '';
        resultBox.innerHTML = `<strong>Succès :</strong> ${detail}${note}`;
      } catch (err) {
        resultBox.textContent = err.message;
        resultBox.classList.add('error');
      }
    });
  </script>
</body>
</html>
